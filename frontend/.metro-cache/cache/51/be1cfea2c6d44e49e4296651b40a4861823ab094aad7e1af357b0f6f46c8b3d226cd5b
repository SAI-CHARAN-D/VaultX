{"dependencies":[{"name":"crypto-js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":125},"end":{"line":4,"column":33,"index":158}}],"key":"TLjsXnAWOlf/gpObabse3HZX8VY=","exportNames":["*"],"imports":1}},{"name":"./keyDerivation","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":159},"end":{"line":5,"column":58,"index":217}}],"key":"pLCGKbCUrckLcIDYaFZ/kr3WNgs=","exportNames":["*"],"imports":1}},{"name":"buffer","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":218},"end":{"line":6,"column":32,"index":250}}],"key":"L2R9OUI0/cSYwzijo34ce4VujKY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.encryptAES256 = encryptAES256;\n  exports.decryptAES256 = decryptAES256;\n  exports.encryptDocument = encryptDocument;\n  exports.decryptDocument = decryptDocument;\n  var _cryptoJs = require(_dependencyMap[0], \"crypto-js\");\n  var CryptoJS = _interopDefault(_cryptoJs);\n  var _keyDerivation = require(_dependencyMap[1], \"./keyDerivation\");\n  var _buffer = require(_dependencyMap[2], \"buffer\");\n  // AES-256-GCM Encryption Service - Zero Knowledge Vault\n  // All encryption happens client-side, server never sees plaintext\n\n  global.Buffer = global.Buffer || _buffer.Buffer;\n  /**\n   * Encrypt data using AES-256-CBC (CryptoJS doesn't support GCM natively)\n   * We simulate GCM by using CBC + HMAC for authentication\n   */\n  function encryptAES256(data, keyHex, ivHex) {\n    const key = CryptoJS.default.enc.Hex.parse(keyHex);\n    const iv = CryptoJS.default.enc.Hex.parse(ivHex);\n    const encrypted = CryptoJS.default.AES.encrypt(data, key, {\n      iv: iv,\n      mode: CryptoJS.default.mode.CBC,\n      padding: CryptoJS.default.pad.Pkcs7\n    });\n\n    // Append HMAC for authentication\n    const hmac = CryptoJS.default.HmacSHA256(encrypted.ciphertext.toString(), key);\n    return encrypted.ciphertext.toString(CryptoJS.default.enc.Base64) + '|' + hmac.toString();\n  }\n\n  /**\n   * Decrypt data using AES-256-CBC with HMAC verification\n   */\n  function decryptAES256(encryptedWithHmac, keyHex, ivHex) {\n    try {\n      const [encryptedBase64, storedHmac] = encryptedWithHmac.split('|');\n      const key = CryptoJS.default.enc.Hex.parse(keyHex);\n      const iv = CryptoJS.default.enc.Hex.parse(ivHex);\n      const ciphertext = CryptoJS.default.enc.Base64.parse(encryptedBase64);\n\n      // Verify HMAC first\n      const computedHmac = CryptoJS.default.HmacSHA256(ciphertext.toString(), key);\n      if (computedHmac.toString() !== storedHmac) {\n        console.error('HMAC verification failed - data may be tampered');\n        return null;\n      }\n      const decrypted = CryptoJS.default.AES.decrypt({\n        ciphertext: ciphertext\n      }, key, {\n        iv: iv,\n        mode: CryptoJS.default.mode.CBC,\n        padding: CryptoJS.default.pad.Pkcs7\n      });\n      return decrypted.toString(CryptoJS.default.enc.Utf8);\n    } catch (error) {\n      console.error('Decryption failed:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Encrypt a document (binary data as base64)\n   * Generates a random FEK, encrypts the document, then encrypts the FEK with master key\n   */\n  async function encryptDocument(documentBase64, masterKey) {\n    // Generate random File Encryption Key\n    const fek = await (0, _keyDerivation.generateFEK)();\n    const dataIV = await (0, _keyDerivation.generateIV)();\n    const fekIV = await (0, _keyDerivation.generateIV)();\n\n    // Encrypt document with FEK\n    const encryptedData = encryptAES256(documentBase64, fek, dataIV);\n\n    // Encrypt FEK with Master Key\n    const encryptedFEK = encryptAES256(fek, masterKey, fekIV);\n    return {\n      encryptedData,\n      encryptedFEK,\n      fekIV,\n      dataIV\n    };\n  }\n\n  /**\n   * Decrypt a document using master key\n   * First decrypts FEK with master key, then decrypts document with FEK\n   */\n  function decryptDocument(encryptedData, encryptedFEK, fekIV, dataIV, masterKey) {\n    // Decrypt FEK with Master Key\n    const fek = decryptAES256(encryptedFEK, masterKey, fekIV);\n    if (!fek) {\n      console.error('Failed to decrypt FEK');\n      return null;\n    }\n\n    // Decrypt document with FEK\n    const document = decryptAES256(encryptedData, fek, dataIV);\n    return document;\n  }\n});","lineCount":111,"map":[[12,2,26,0,"exports"],[12,9,26,0],[12,10,26,0,"encryptAES256"],[12,23,26,0],[12,26,26,0,"encryptAES256"],[12,39,26,0],[13,2,45,0,"exports"],[13,9,45,0],[13,10,45,0,"decryptAES256"],[13,23,45,0],[13,26,45,0,"decryptAES256"],[13,39,45,0],[14,2,81,0,"exports"],[14,9,81,0],[14,10,81,0,"encryptDocument"],[14,25,81,0],[14,28,81,0,"encryptDocument"],[14,43,81,0],[15,2,108,0,"exports"],[15,9,108,0],[15,10,108,0,"decryptDocument"],[15,25,108,0],[15,28,108,0,"decryptDocument"],[15,43,108,0],[16,2,4,0],[16,6,4,0,"_cryptoJs"],[16,15,4,0],[16,18,4,0,"require"],[16,25,4,0],[16,26,4,0,"_dependencyMap"],[16,40,4,0],[17,2,4,0],[17,6,4,0,"CryptoJS"],[17,14,4,0],[17,17,4,0,"_interopDefault"],[17,32,4,0],[17,33,4,0,"_cryptoJs"],[17,42,4,0],[18,2,5,0],[18,6,5,0,"_keyDerivation"],[18,20,5,0],[18,23,5,0,"require"],[18,30,5,0],[18,31,5,0,"_dependencyMap"],[18,45,5,0],[19,2,6,0],[19,6,6,0,"_buffer"],[19,13,6,0],[19,16,6,0,"require"],[19,23,6,0],[19,24,6,0,"_dependencyMap"],[19,38,6,0],[20,2,1,0],[21,2,2,0],[23,2,8,0,"global"],[23,8,8,6],[23,9,8,7,"Buffer"],[23,15,8,13],[23,18,8,16,"global"],[23,24,8,22],[23,25,8,23,"Buffer"],[23,31,8,29],[23,35,8,33,"Buffer"],[23,42,8,39],[23,43,8,39,"Buffer"],[23,49,8,39],[24,2,22,0],[25,0,23,0],[26,0,24,0],[27,0,25,0],[28,2,26,7],[28,11,26,16,"encryptAES256"],[28,24,26,29,"encryptAES256"],[28,25,26,30,"data"],[28,29,26,42],[28,31,26,44,"keyHex"],[28,37,26,58],[28,39,26,60,"ivHex"],[28,44,26,73],[28,46,26,83],[29,4,27,2],[29,10,27,8,"key"],[29,13,27,11],[29,16,27,14,"CryptoJS"],[29,24,27,22],[29,25,27,22,"default"],[29,32,27,22],[29,33,27,23,"enc"],[29,36,27,26],[29,37,27,27,"Hex"],[29,40,27,30],[29,41,27,31,"parse"],[29,46,27,36],[29,47,27,37,"keyHex"],[29,53,27,43],[29,54,27,44],[30,4,28,2],[30,10,28,8,"iv"],[30,12,28,10],[30,15,28,13,"CryptoJS"],[30,23,28,21],[30,24,28,21,"default"],[30,31,28,21],[30,32,28,22,"enc"],[30,35,28,25],[30,36,28,26,"Hex"],[30,39,28,29],[30,40,28,30,"parse"],[30,45,28,35],[30,46,28,36,"ivHex"],[30,51,28,41],[30,52,28,42],[31,4,30,2],[31,10,30,8,"encrypted"],[31,19,30,17],[31,22,30,20,"CryptoJS"],[31,30,30,28],[31,31,30,28,"default"],[31,38,30,28],[31,39,30,29,"AES"],[31,42,30,32],[31,43,30,33,"encrypt"],[31,50,30,40],[31,51,30,41,"data"],[31,55,30,45],[31,57,30,47,"key"],[31,60,30,50],[31,62,30,52],[32,6,31,4,"iv"],[32,8,31,6],[32,10,31,8,"iv"],[32,12,31,10],[33,6,32,4,"mode"],[33,10,32,8],[33,12,32,10,"CryptoJS"],[33,20,32,18],[33,21,32,18,"default"],[33,28,32,18],[33,29,32,19,"mode"],[33,33,32,23],[33,34,32,24,"CBC"],[33,37,32,27],[34,6,33,4,"padding"],[34,13,33,11],[34,15,33,13,"CryptoJS"],[34,23,33,21],[34,24,33,21,"default"],[34,31,33,21],[34,32,33,22,"pad"],[34,35,33,25],[34,36,33,26,"Pkcs7"],[35,4,34,2],[35,5,34,3],[35,6,34,4],[37,4,36,2],[38,4,37,2],[38,10,37,8,"hmac"],[38,14,37,12],[38,17,37,15,"CryptoJS"],[38,25,37,23],[38,26,37,23,"default"],[38,33,37,23],[38,34,37,24,"HmacSHA256"],[38,44,37,34],[38,45,37,35,"encrypted"],[38,54,37,44],[38,55,37,45,"ciphertext"],[38,65,37,55],[38,66,37,56,"toString"],[38,74,37,64],[38,75,37,65],[38,76,37,66],[38,78,37,68,"key"],[38,81,37,71],[38,82,37,72],[39,4,39,2],[39,11,39,9,"encrypted"],[39,20,39,18],[39,21,39,19,"ciphertext"],[39,31,39,29],[39,32,39,30,"toString"],[39,40,39,38],[39,41,39,39,"CryptoJS"],[39,49,39,47],[39,50,39,47,"default"],[39,57,39,47],[39,58,39,48,"enc"],[39,61,39,51],[39,62,39,52,"Base64"],[39,68,39,58],[39,69,39,59],[39,72,39,62],[39,75,39,65],[39,78,39,68,"hmac"],[39,82,39,72],[39,83,39,73,"toString"],[39,91,39,81],[39,92,39,82],[39,93,39,83],[40,2,40,0],[42,2,42,0],[43,0,43,0],[44,0,44,0],[45,2,45,7],[45,11,45,16,"decryptAES256"],[45,24,45,29,"decryptAES256"],[45,25,45,30,"encryptedWithHmac"],[45,42,45,55],[45,44,45,57,"keyHex"],[45,50,45,71],[45,52,45,73,"ivHex"],[45,57,45,86],[45,59,45,103],[46,4,46,2],[46,8,46,6],[47,6,47,4],[47,12,47,10],[47,13,47,11,"encryptedBase64"],[47,28,47,26],[47,30,47,28,"storedHmac"],[47,40,47,38],[47,41,47,39],[47,44,47,42,"encryptedWithHmac"],[47,61,47,59],[47,62,47,60,"split"],[47,67,47,65],[47,68,47,66],[47,71,47,69],[47,72,47,70],[48,6,49,4],[48,12,49,10,"key"],[48,15,49,13],[48,18,49,16,"CryptoJS"],[48,26,49,24],[48,27,49,24,"default"],[48,34,49,24],[48,35,49,25,"enc"],[48,38,49,28],[48,39,49,29,"Hex"],[48,42,49,32],[48,43,49,33,"parse"],[48,48,49,38],[48,49,49,39,"keyHex"],[48,55,49,45],[48,56,49,46],[49,6,50,4],[49,12,50,10,"iv"],[49,14,50,12],[49,17,50,15,"CryptoJS"],[49,25,50,23],[49,26,50,23,"default"],[49,33,50,23],[49,34,50,24,"enc"],[49,37,50,27],[49,38,50,28,"Hex"],[49,41,50,31],[49,42,50,32,"parse"],[49,47,50,37],[49,48,50,38,"ivHex"],[49,53,50,43],[49,54,50,44],[50,6,51,4],[50,12,51,10,"ciphertext"],[50,22,51,20],[50,25,51,23,"CryptoJS"],[50,33,51,31],[50,34,51,31,"default"],[50,41,51,31],[50,42,51,32,"enc"],[50,45,51,35],[50,46,51,36,"Base64"],[50,52,51,42],[50,53,51,43,"parse"],[50,58,51,48],[50,59,51,49,"encryptedBase64"],[50,74,51,64],[50,75,51,65],[52,6,53,4],[53,6,54,4],[53,12,54,10,"computedHmac"],[53,24,54,22],[53,27,54,25,"CryptoJS"],[53,35,54,33],[53,36,54,33,"default"],[53,43,54,33],[53,44,54,34,"HmacSHA256"],[53,54,54,44],[53,55,54,45,"ciphertext"],[53,65,54,55],[53,66,54,56,"toString"],[53,74,54,64],[53,75,54,65],[53,76,54,66],[53,78,54,68,"key"],[53,81,54,71],[53,82,54,72],[54,6,55,4],[54,10,55,8,"computedHmac"],[54,22,55,20],[54,23,55,21,"toString"],[54,31,55,29],[54,32,55,30],[54,33,55,31],[54,38,55,36,"storedHmac"],[54,48,55,46],[54,50,55,48],[55,8,56,6,"console"],[55,15,56,13],[55,16,56,14,"error"],[55,21,56,19],[55,22,56,20],[55,71,56,69],[55,72,56,70],[56,8,57,6],[56,15,57,13],[56,19,57,17],[57,6,58,4],[58,6,60,4],[58,12,60,10,"decrypted"],[58,21,60,19],[58,24,60,22,"CryptoJS"],[58,32,60,30],[58,33,60,30,"default"],[58,40,60,30],[58,41,60,31,"AES"],[58,44,60,34],[58,45,60,35,"decrypt"],[58,52,60,42],[58,53,61,6],[59,8,61,8,"ciphertext"],[59,18,61,18],[59,20,61,20,"ciphertext"],[60,6,61,31],[60,7,61,32],[60,9,62,6,"key"],[60,12,62,9],[60,14,63,6],[61,8,64,8,"iv"],[61,10,64,10],[61,12,64,12,"iv"],[61,14,64,14],[62,8,65,8,"mode"],[62,12,65,12],[62,14,65,14,"CryptoJS"],[62,22,65,22],[62,23,65,22,"default"],[62,30,65,22],[62,31,65,23,"mode"],[62,35,65,27],[62,36,65,28,"CBC"],[62,39,65,31],[63,8,66,8,"padding"],[63,15,66,15],[63,17,66,17,"CryptoJS"],[63,25,66,25],[63,26,66,25,"default"],[63,33,66,25],[63,34,66,26,"pad"],[63,37,66,29],[63,38,66,30,"Pkcs7"],[64,6,67,6],[64,7,68,4],[64,8,68,5],[65,6,70,4],[65,13,70,11,"decrypted"],[65,22,70,20],[65,23,70,21,"toString"],[65,31,70,29],[65,32,70,30,"CryptoJS"],[65,40,70,38],[65,41,70,38,"default"],[65,48,70,38],[65,49,70,39,"enc"],[65,52,70,42],[65,53,70,43,"Utf8"],[65,57,70,47],[65,58,70,48],[66,4,71,2],[66,5,71,3],[66,6,71,4],[66,13,71,11,"error"],[66,18,71,16],[66,20,71,18],[67,6,72,4,"console"],[67,13,72,11],[67,14,72,12,"error"],[67,19,72,17],[67,20,72,18],[67,40,72,38],[67,42,72,40,"error"],[67,47,72,45],[67,48,72,46],[68,6,73,4],[68,13,73,11],[68,17,73,15],[69,4,74,2],[70,2,75,0],[72,2,77,0],[73,0,78,0],[74,0,79,0],[75,0,80,0],[76,2,81,7],[76,17,81,22,"encryptDocument"],[76,32,81,37,"encryptDocument"],[76,33,82,2,"documentBase64"],[76,47,82,24],[76,49,83,2,"masterKey"],[76,58,83,19],[76,60,84,37],[77,4,85,2],[78,4,86,2],[78,10,86,8,"fek"],[78,13,86,11],[78,16,86,14],[78,22,86,20],[78,26,86,20,"generateFEK"],[78,40,86,31],[78,41,86,31,"generateFEK"],[78,52,86,31],[78,54,86,32],[78,55,86,33],[79,4,87,2],[79,10,87,8,"dataIV"],[79,16,87,14],[79,19,87,17],[79,25,87,23],[79,29,87,23,"generateIV"],[79,43,87,33],[79,44,87,33,"generateIV"],[79,54,87,33],[79,56,87,34],[79,57,87,35],[80,4,88,2],[80,10,88,8,"fekIV"],[80,15,88,13],[80,18,88,16],[80,24,88,22],[80,28,88,22,"generateIV"],[80,42,88,32],[80,43,88,32,"generateIV"],[80,53,88,32],[80,55,88,33],[80,56,88,34],[82,4,90,2],[83,4,91,2],[83,10,91,8,"encryptedData"],[83,23,91,21],[83,26,91,24,"encryptAES256"],[83,39,91,37],[83,40,91,38,"documentBase64"],[83,54,91,52],[83,56,91,54,"fek"],[83,59,91,57],[83,61,91,59,"dataIV"],[83,67,91,65],[83,68,91,66],[85,4,93,2],[86,4,94,2],[86,10,94,8,"encryptedFEK"],[86,22,94,20],[86,25,94,23,"encryptAES256"],[86,38,94,36],[86,39,94,37,"fek"],[86,42,94,40],[86,44,94,42,"masterKey"],[86,53,94,51],[86,55,94,53,"fekIV"],[86,60,94,58],[86,61,94,59],[87,4,96,2],[87,11,96,9],[88,6,97,4,"encryptedData"],[88,19,97,17],[89,6,98,4,"encryptedFEK"],[89,18,98,16],[90,6,99,4,"fekIV"],[90,11,99,9],[91,6,100,4,"dataIV"],[92,4,101,2],[92,5,101,3],[93,2,102,0],[95,2,104,0],[96,0,105,0],[97,0,106,0],[98,0,107,0],[99,2,108,7],[99,11,108,16,"decryptDocument"],[99,26,108,31,"decryptDocument"],[99,27,109,2,"encryptedData"],[99,40,109,23],[99,42,110,2,"encryptedFEK"],[99,54,110,22],[99,56,111,2,"fekIV"],[99,61,111,15],[99,63,112,2,"dataIV"],[99,69,112,16],[99,71,113,2,"masterKey"],[99,80,113,19],[99,82,114,17],[100,4,115,2],[101,4,116,2],[101,10,116,8,"fek"],[101,13,116,11],[101,16,116,14,"decryptAES256"],[101,29,116,27],[101,30,116,28,"encryptedFEK"],[101,42,116,40],[101,44,116,42,"masterKey"],[101,53,116,51],[101,55,116,53,"fekIV"],[101,60,116,58],[101,61,116,59],[102,4,117,2],[102,8,117,6],[102,9,117,7,"fek"],[102,12,117,10],[102,14,117,12],[103,6,118,4,"console"],[103,13,118,11],[103,14,118,12,"error"],[103,19,118,17],[103,20,118,18],[103,43,118,41],[103,44,118,42],[104,6,119,4],[104,13,119,11],[104,17,119,15],[105,4,120,2],[107,4,122,2],[108,4,123,2],[108,10,123,8,"document"],[108,18,123,16],[108,21,123,19,"decryptAES256"],[108,34,123,32],[108,35,123,33,"encryptedData"],[108,48,123,46],[108,50,123,48,"fek"],[108,53,123,51],[108,55,123,53,"dataIV"],[108,61,123,59],[108,62,123,60],[109,4,124,2],[109,11,124,9,"document"],[109,19,124,17],[110,2,125,0],[111,0,125,1],[111,3]],"functionMap":{"names":["<global>","encryptAES256","decryptAES256","encryptDocument","decryptDocument"],"mappings":"AAA;OCyB;CDc;OEK;CF8B;OGM;CHqB;OIM;CJiB"},"hasCjsExports":false},"type":"js/module"}]}