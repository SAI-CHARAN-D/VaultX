{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"@babel/runtime/helpers/slicedToArray","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"5y7e5+zC7teYEEC6niD9f5zII1M=","exportNames":["*"],"imports":1}},{"name":"crypto-js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":125},"end":{"line":4,"column":33,"index":158}}],"key":"TLjsXnAWOlf/gpObabse3HZX8VY=","exportNames":["*"],"imports":1}},{"name":"./keyDerivation","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":5,"column":0,"index":159},"end":{"line":5,"column":58,"index":217}}],"key":"pLCGKbCUrckLcIDYaFZ/kr3WNgs=","exportNames":["*"],"imports":1}},{"name":"buffer","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":6,"column":0,"index":218},"end":{"line":6,"column":32,"index":250}}],"key":"L2R9OUI0/cSYwzijo34ce4VujKY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.encryptAES256 = encryptAES256;\n  exports.decryptAES256 = decryptAES256;\n  exports.encryptDocument = encryptDocument;\n  exports.decryptDocument = decryptDocument;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _babelRuntimeHelpersSlicedToArray = require(_dependencyMap[1], \"@babel/runtime/helpers/slicedToArray\");\n  var _slicedToArray = _interopDefault(_babelRuntimeHelpersSlicedToArray);\n  var _cryptoJs = require(_dependencyMap[2], \"crypto-js\");\n  var CryptoJS = _interopDefault(_cryptoJs);\n  var _keyDerivation = require(_dependencyMap[3], \"./keyDerivation\");\n  var _buffer = require(_dependencyMap[4], \"buffer\");\n  // AES-256-GCM Encryption Service - Zero Knowledge Vault\n  // All encryption happens client-side, server never sees plaintext\n\n  global.Buffer = global.Buffer || _buffer.Buffer;\n  /**\n   * Encrypt data using AES-256-CBC (CryptoJS doesn't support GCM natively)\n   * We simulate GCM by using CBC + HMAC for authentication\n   */\n  function encryptAES256(data, keyHex, ivHex) {\n    var key = CryptoJS.default.enc.Hex.parse(keyHex);\n    var iv = CryptoJS.default.enc.Hex.parse(ivHex);\n    var encrypted = CryptoJS.default.AES.encrypt(data, key, {\n      iv: iv,\n      mode: CryptoJS.default.mode.CBC,\n      padding: CryptoJS.default.pad.Pkcs7\n    });\n\n    // Append HMAC for authentication\n    var hmac = CryptoJS.default.HmacSHA256(encrypted.ciphertext.toString(), key);\n    return encrypted.ciphertext.toString(CryptoJS.default.enc.Base64) + '|' + hmac.toString();\n  }\n\n  /**\n   * Decrypt data using AES-256-CBC with HMAC verification\n   */\n  function decryptAES256(encryptedWithHmac, keyHex, ivHex) {\n    try {\n      var _encryptedWithHmac$sp = encryptedWithHmac.split('|'),\n        _encryptedWithHmac$sp2 = (0, _slicedToArray.default)(_encryptedWithHmac$sp, 2),\n        encryptedBase64 = _encryptedWithHmac$sp2[0],\n        storedHmac = _encryptedWithHmac$sp2[1];\n      var key = CryptoJS.default.enc.Hex.parse(keyHex);\n      var iv = CryptoJS.default.enc.Hex.parse(ivHex);\n      var ciphertext = CryptoJS.default.enc.Base64.parse(encryptedBase64);\n\n      // Verify HMAC first\n      var computedHmac = CryptoJS.default.HmacSHA256(ciphertext.toString(), key);\n      if (computedHmac.toString() !== storedHmac) {\n        console.error('HMAC verification failed - data may be tampered');\n        return null;\n      }\n      var decrypted = CryptoJS.default.AES.decrypt({\n        ciphertext: ciphertext\n      }, key, {\n        iv: iv,\n        mode: CryptoJS.default.mode.CBC,\n        padding: CryptoJS.default.pad.Pkcs7\n      });\n      return decrypted.toString(CryptoJS.default.enc.Utf8);\n    } catch (error) {\n      console.error('Decryption failed:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Encrypt a document (binary data as base64)\n   * Generates a random FEK, encrypts the document, then encrypts the FEK with master key\n   */\n  function encryptDocument(_x, _x2) {\n    return _encryptDocument.apply(this, arguments);\n  }\n  /**\n   * Decrypt a document using master key\n   * First decrypts FEK with master key, then decrypts document with FEK\n   */\n  function _encryptDocument() {\n    _encryptDocument = (0, _asyncToGenerator.default)(function* (documentBase64, masterKey) {\n      // Generate random File Encryption Key\n      var fek = yield (0, _keyDerivation.generateFEK)();\n      var dataIV = yield (0, _keyDerivation.generateIV)();\n      var fekIV = yield (0, _keyDerivation.generateIV)();\n\n      // Encrypt document with FEK\n      var encryptedData = encryptAES256(documentBase64, fek, dataIV);\n\n      // Encrypt FEK with Master Key\n      var encryptedFEK = encryptAES256(fek, masterKey, fekIV);\n      return {\n        encryptedData,\n        encryptedFEK,\n        fekIV,\n        dataIV\n      };\n    });\n    return _encryptDocument.apply(this, arguments);\n  }\n  function decryptDocument(encryptedData, encryptedFEK, fekIV, dataIV, masterKey) {\n    // Decrypt FEK with Master Key\n    var fek = decryptAES256(encryptedFEK, masterKey, fekIV);\n    if (!fek) {\n      console.error('Failed to decrypt FEK');\n      return null;\n    }\n\n    // Decrypt document with FEK\n    var document = decryptAES256(encryptedData, fek, dataIV);\n    return document;\n  }\n});","lineCount":123,"map":[[12,2,26,0,"exports"],[12,9,26,0],[12,10,26,0,"encryptAES256"],[12,23,26,0],[12,26,26,0,"encryptAES256"],[12,39,26,0],[13,2,45,0,"exports"],[13,9,45,0],[13,10,45,0,"decryptAES256"],[13,23,45,0],[13,26,45,0,"decryptAES256"],[13,39,45,0],[14,2,81,0,"exports"],[14,9,81,0],[14,10,81,0,"encryptDocument"],[14,25,81,0],[14,28,81,0,"encryptDocument"],[14,43,81,0],[15,2,108,0,"exports"],[15,9,108,0],[15,10,108,0,"decryptDocument"],[15,25,108,0],[15,28,108,0,"decryptDocument"],[15,43,108,0],[16,2,125,1],[16,6,125,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,42,125,1],[16,45,125,1,"require"],[16,52,125,1],[16,53,125,1,"_dependencyMap"],[16,67,125,1],[17,2,125,1],[17,6,125,1,"_asyncToGenerator"],[17,23,125,1],[17,26,125,1,"_interopDefault"],[17,41,125,1],[17,42,125,1,"_babelRuntimeHelpersAsyncToGenerator"],[17,78,125,1],[18,2,125,1],[18,6,125,1,"_babelRuntimeHelpersSlicedToArray"],[18,39,125,1],[18,42,125,1,"require"],[18,49,125,1],[18,50,125,1,"_dependencyMap"],[18,64,125,1],[19,2,125,1],[19,6,125,1,"_slicedToArray"],[19,20,125,1],[19,23,125,1,"_interopDefault"],[19,38,125,1],[19,39,125,1,"_babelRuntimeHelpersSlicedToArray"],[19,72,125,1],[20,2,4,0],[20,6,4,0,"_cryptoJs"],[20,15,4,0],[20,18,4,0,"require"],[20,25,4,0],[20,26,4,0,"_dependencyMap"],[20,40,4,0],[21,2,4,0],[21,6,4,0,"CryptoJS"],[21,14,4,0],[21,17,4,0,"_interopDefault"],[21,32,4,0],[21,33,4,0,"_cryptoJs"],[21,42,4,0],[22,2,5,0],[22,6,5,0,"_keyDerivation"],[22,20,5,0],[22,23,5,0,"require"],[22,30,5,0],[22,31,5,0,"_dependencyMap"],[22,45,5,0],[23,2,6,0],[23,6,6,0,"_buffer"],[23,13,6,0],[23,16,6,0,"require"],[23,23,6,0],[23,24,6,0,"_dependencyMap"],[23,38,6,0],[24,2,1,0],[25,2,2,0],[27,2,8,0,"global"],[27,8,8,6],[27,9,8,7,"Buffer"],[27,15,8,13],[27,18,8,16,"global"],[27,24,8,22],[27,25,8,23,"Buffer"],[27,31,8,29],[27,35,8,33,"Buffer"],[27,42,8,39],[27,43,8,39,"Buffer"],[27,49,8,39],[28,2,22,0],[29,0,23,0],[30,0,24,0],[31,0,25,0],[32,2,26,7],[32,11,26,16,"encryptAES256"],[32,24,26,29,"encryptAES256"],[32,25,26,30,"data"],[32,29,26,42],[32,31,26,44,"keyHex"],[32,37,26,58],[32,39,26,60,"ivHex"],[32,44,26,73],[32,46,26,83],[33,4,27,2],[33,8,27,8,"key"],[33,11,27,11],[33,14,27,14,"CryptoJS"],[33,22,27,22],[33,23,27,22,"default"],[33,30,27,22],[33,31,27,23,"enc"],[33,34,27,26],[33,35,27,27,"Hex"],[33,38,27,30],[33,39,27,31,"parse"],[33,44,27,36],[33,45,27,37,"keyHex"],[33,51,27,43],[33,52,27,44],[34,4,28,2],[34,8,28,8,"iv"],[34,10,28,10],[34,13,28,13,"CryptoJS"],[34,21,28,21],[34,22,28,21,"default"],[34,29,28,21],[34,30,28,22,"enc"],[34,33,28,25],[34,34,28,26,"Hex"],[34,37,28,29],[34,38,28,30,"parse"],[34,43,28,35],[34,44,28,36,"ivHex"],[34,49,28,41],[34,50,28,42],[35,4,30,2],[35,8,30,8,"encrypted"],[35,17,30,17],[35,20,30,20,"CryptoJS"],[35,28,30,28],[35,29,30,28,"default"],[35,36,30,28],[35,37,30,29,"AES"],[35,40,30,32],[35,41,30,33,"encrypt"],[35,48,30,40],[35,49,30,41,"data"],[35,53,30,45],[35,55,30,47,"key"],[35,58,30,50],[35,60,30,52],[36,6,31,4,"iv"],[36,8,31,6],[36,10,31,8,"iv"],[36,12,31,10],[37,6,32,4,"mode"],[37,10,32,8],[37,12,32,10,"CryptoJS"],[37,20,32,18],[37,21,32,18,"default"],[37,28,32,18],[37,29,32,19,"mode"],[37,33,32,23],[37,34,32,24,"CBC"],[37,37,32,27],[38,6,33,4,"padding"],[38,13,33,11],[38,15,33,13,"CryptoJS"],[38,23,33,21],[38,24,33,21,"default"],[38,31,33,21],[38,32,33,22,"pad"],[38,35,33,25],[38,36,33,26,"Pkcs7"],[39,4,34,2],[39,5,34,3],[39,6,34,4],[41,4,36,2],[42,4,37,2],[42,8,37,8,"hmac"],[42,12,37,12],[42,15,37,15,"CryptoJS"],[42,23,37,23],[42,24,37,23,"default"],[42,31,37,23],[42,32,37,24,"HmacSHA256"],[42,42,37,34],[42,43,37,35,"encrypted"],[42,52,37,44],[42,53,37,45,"ciphertext"],[42,63,37,55],[42,64,37,56,"toString"],[42,72,37,64],[42,73,37,65],[42,74,37,66],[42,76,37,68,"key"],[42,79,37,71],[42,80,37,72],[43,4,39,2],[43,11,39,9,"encrypted"],[43,20,39,18],[43,21,39,19,"ciphertext"],[43,31,39,29],[43,32,39,30,"toString"],[43,40,39,38],[43,41,39,39,"CryptoJS"],[43,49,39,47],[43,50,39,47,"default"],[43,57,39,47],[43,58,39,48,"enc"],[43,61,39,51],[43,62,39,52,"Base64"],[43,68,39,58],[43,69,39,59],[43,72,39,62],[43,75,39,65],[43,78,39,68,"hmac"],[43,82,39,72],[43,83,39,73,"toString"],[43,91,39,81],[43,92,39,82],[43,93,39,83],[44,2,40,0],[46,2,42,0],[47,0,43,0],[48,0,44,0],[49,2,45,7],[49,11,45,16,"decryptAES256"],[49,24,45,29,"decryptAES256"],[49,25,45,30,"encryptedWithHmac"],[49,42,45,55],[49,44,45,57,"keyHex"],[49,50,45,71],[49,52,45,73,"ivHex"],[49,57,45,86],[49,59,45,103],[50,4,46,2],[50,8,46,6],[51,6,47,4],[51,10,47,4,"_encryptedWithHmac$sp"],[51,31,47,4],[51,34,47,42,"encryptedWithHmac"],[51,51,47,59],[51,52,47,60,"split"],[51,57,47,65],[51,58,47,66],[51,61,47,69],[51,62,47,70],[52,8,47,70,"_encryptedWithHmac$sp2"],[52,30,47,70],[52,37,47,70,"_slicedToArray"],[52,51,47,70],[52,52,47,70,"default"],[52,59,47,70],[52,61,47,70,"_encryptedWithHmac$sp"],[52,82,47,70],[53,8,47,11,"encryptedBase64"],[53,23,47,26],[53,26,47,26,"_encryptedWithHmac$sp2"],[53,48,47,26],[54,8,47,28,"storedHmac"],[54,18,47,38],[54,21,47,38,"_encryptedWithHmac$sp2"],[54,43,47,38],[55,6,49,4],[55,10,49,10,"key"],[55,13,49,13],[55,16,49,16,"CryptoJS"],[55,24,49,24],[55,25,49,24,"default"],[55,32,49,24],[55,33,49,25,"enc"],[55,36,49,28],[55,37,49,29,"Hex"],[55,40,49,32],[55,41,49,33,"parse"],[55,46,49,38],[55,47,49,39,"keyHex"],[55,53,49,45],[55,54,49,46],[56,6,50,4],[56,10,50,10,"iv"],[56,12,50,12],[56,15,50,15,"CryptoJS"],[56,23,50,23],[56,24,50,23,"default"],[56,31,50,23],[56,32,50,24,"enc"],[56,35,50,27],[56,36,50,28,"Hex"],[56,39,50,31],[56,40,50,32,"parse"],[56,45,50,37],[56,46,50,38,"ivHex"],[56,51,50,43],[56,52,50,44],[57,6,51,4],[57,10,51,10,"ciphertext"],[57,20,51,20],[57,23,51,23,"CryptoJS"],[57,31,51,31],[57,32,51,31,"default"],[57,39,51,31],[57,40,51,32,"enc"],[57,43,51,35],[57,44,51,36,"Base64"],[57,50,51,42],[57,51,51,43,"parse"],[57,56,51,48],[57,57,51,49,"encryptedBase64"],[57,72,51,64],[57,73,51,65],[59,6,53,4],[60,6,54,4],[60,10,54,10,"computedHmac"],[60,22,54,22],[60,25,54,25,"CryptoJS"],[60,33,54,33],[60,34,54,33,"default"],[60,41,54,33],[60,42,54,34,"HmacSHA256"],[60,52,54,44],[60,53,54,45,"ciphertext"],[60,63,54,55],[60,64,54,56,"toString"],[60,72,54,64],[60,73,54,65],[60,74,54,66],[60,76,54,68,"key"],[60,79,54,71],[60,80,54,72],[61,6,55,4],[61,10,55,8,"computedHmac"],[61,22,55,20],[61,23,55,21,"toString"],[61,31,55,29],[61,32,55,30],[61,33,55,31],[61,38,55,36,"storedHmac"],[61,48,55,46],[61,50,55,48],[62,8,56,6,"console"],[62,15,56,13],[62,16,56,14,"error"],[62,21,56,19],[62,22,56,20],[62,71,56,69],[62,72,56,70],[63,8,57,6],[63,15,57,13],[63,19,57,17],[64,6,58,4],[65,6,60,4],[65,10,60,10,"decrypted"],[65,19,60,19],[65,22,60,22,"CryptoJS"],[65,30,60,30],[65,31,60,30,"default"],[65,38,60,30],[65,39,60,31,"AES"],[65,42,60,34],[65,43,60,35,"decrypt"],[65,50,60,42],[65,51,61,6],[66,8,61,8,"ciphertext"],[66,18,61,18],[66,20,61,20,"ciphertext"],[67,6,61,31],[67,7,61,32],[67,9,62,6,"key"],[67,12,62,9],[67,14,63,6],[68,8,64,8,"iv"],[68,10,64,10],[68,12,64,12,"iv"],[68,14,64,14],[69,8,65,8,"mode"],[69,12,65,12],[69,14,65,14,"CryptoJS"],[69,22,65,22],[69,23,65,22,"default"],[69,30,65,22],[69,31,65,23,"mode"],[69,35,65,27],[69,36,65,28,"CBC"],[69,39,65,31],[70,8,66,8,"padding"],[70,15,66,15],[70,17,66,17,"CryptoJS"],[70,25,66,25],[70,26,66,25,"default"],[70,33,66,25],[70,34,66,26,"pad"],[70,37,66,29],[70,38,66,30,"Pkcs7"],[71,6,67,6],[71,7,68,4],[71,8,68,5],[72,6,70,4],[72,13,70,11,"decrypted"],[72,22,70,20],[72,23,70,21,"toString"],[72,31,70,29],[72,32,70,30,"CryptoJS"],[72,40,70,38],[72,41,70,38,"default"],[72,48,70,38],[72,49,70,39,"enc"],[72,52,70,42],[72,53,70,43,"Utf8"],[72,57,70,47],[72,58,70,48],[73,4,71,2],[73,5,71,3],[73,6,71,4],[73,13,71,11,"error"],[73,18,71,16],[73,20,71,18],[74,6,72,4,"console"],[74,13,72,11],[74,14,72,12,"error"],[74,19,72,17],[74,20,72,18],[74,40,72,38],[74,42,72,40,"error"],[74,47,72,45],[74,48,72,46],[75,6,73,4],[75,13,73,11],[75,17,73,15],[76,4,74,2],[77,2,75,0],[79,2,77,0],[80,0,78,0],[81,0,79,0],[82,0,80,0],[83,2,77,0],[83,11,81,22,"encryptDocument"],[83,26,81,37,"encryptDocument"],[83,27,81,37,"_x"],[83,29,81,37],[83,31,81,37,"_x2"],[83,34,81,37],[84,4,81,37],[84,11,81,37,"_encryptDocument"],[84,27,81,37],[84,28,81,37,"apply"],[84,33,81,37],[84,40,81,37,"arguments"],[84,49,81,37],[85,2,81,37],[86,2,104,0],[87,0,105,0],[88,0,106,0],[89,0,107,0],[90,2,104,0],[90,11,104,0,"_encryptDocument"],[90,28,104,0],[91,4,104,0,"_encryptDocument"],[91,20,104,0],[91,27,104,0,"_asyncToGenerator"],[91,44,104,0],[91,45,104,0,"default"],[91,52,104,0],[91,54,81,7],[91,65,82,2,"documentBase64"],[91,79,82,24],[91,81,83,2,"masterKey"],[91,90,83,19],[91,92,84,37],[92,6,85,2],[93,6,86,2],[93,10,86,8,"fek"],[93,13,86,11],[93,22,86,20],[93,26,86,20,"generateFEK"],[93,40,86,31],[93,41,86,31,"generateFEK"],[93,52,86,31],[93,54,86,32],[93,55,86,33],[94,6,87,2],[94,10,87,8,"dataIV"],[94,16,87,14],[94,25,87,23],[94,29,87,23,"generateIV"],[94,43,87,33],[94,44,87,33,"generateIV"],[94,54,87,33],[94,56,87,34],[94,57,87,35],[95,6,88,2],[95,10,88,8,"fekIV"],[95,15,88,13],[95,24,88,22],[95,28,88,22,"generateIV"],[95,42,88,32],[95,43,88,32,"generateIV"],[95,53,88,32],[95,55,88,33],[95,56,88,34],[97,6,90,2],[98,6,91,2],[98,10,91,8,"encryptedData"],[98,23,91,21],[98,26,91,24,"encryptAES256"],[98,39,91,37],[98,40,91,38,"documentBase64"],[98,54,91,52],[98,56,91,54,"fek"],[98,59,91,57],[98,61,91,59,"dataIV"],[98,67,91,65],[98,68,91,66],[100,6,93,2],[101,6,94,2],[101,10,94,8,"encryptedFEK"],[101,22,94,20],[101,25,94,23,"encryptAES256"],[101,38,94,36],[101,39,94,37,"fek"],[101,42,94,40],[101,44,94,42,"masterKey"],[101,53,94,51],[101,55,94,53,"fekIV"],[101,60,94,58],[101,61,94,59],[102,6,96,2],[102,13,96,9],[103,8,97,4,"encryptedData"],[103,21,97,17],[104,8,98,4,"encryptedFEK"],[104,20,98,16],[105,8,99,4,"fekIV"],[105,13,99,9],[106,8,100,4,"dataIV"],[107,6,101,2],[107,7,101,3],[108,4,102,0],[108,5,102,1],[109,4,102,1],[109,11,102,1,"_encryptDocument"],[109,27,102,1],[109,28,102,1,"apply"],[109,33,102,1],[109,40,102,1,"arguments"],[109,49,102,1],[110,2,102,1],[111,2,108,7],[111,11,108,16,"decryptDocument"],[111,26,108,31,"decryptDocument"],[111,27,109,2,"encryptedData"],[111,40,109,23],[111,42,110,2,"encryptedFEK"],[111,54,110,22],[111,56,111,2,"fekIV"],[111,61,111,15],[111,63,112,2,"dataIV"],[111,69,112,16],[111,71,113,2,"masterKey"],[111,80,113,19],[111,82,114,17],[112,4,115,2],[113,4,116,2],[113,8,116,8,"fek"],[113,11,116,11],[113,14,116,14,"decryptAES256"],[113,27,116,27],[113,28,116,28,"encryptedFEK"],[113,40,116,40],[113,42,116,42,"masterKey"],[113,51,116,51],[113,53,116,53,"fekIV"],[113,58,116,58],[113,59,116,59],[114,4,117,2],[114,8,117,6],[114,9,117,7,"fek"],[114,12,117,10],[114,14,117,12],[115,6,118,4,"console"],[115,13,118,11],[115,14,118,12,"error"],[115,19,118,17],[115,20,118,18],[115,43,118,41],[115,44,118,42],[116,6,119,4],[116,13,119,11],[116,17,119,15],[117,4,120,2],[119,4,122,2],[120,4,123,2],[120,8,123,8,"document"],[120,16,123,16],[120,19,123,19,"decryptAES256"],[120,32,123,32],[120,33,123,33,"encryptedData"],[120,46,123,46],[120,48,123,48,"fek"],[120,51,123,51],[120,53,123,53,"dataIV"],[120,59,123,59],[120,60,123,60],[121,4,124,2],[121,11,124,9,"document"],[121,19,124,17],[122,2,125,0],[123,0,125,1],[123,3]],"functionMap":{"names":["<global>","encryptAES256","decryptAES256","encryptDocument","decryptDocument"],"mappings":"AAA;OCyB;CDc;OEK;CF8B;OGM;CHqB;OIM;CJiB"},"hasCjsExports":false},"type":"js/module"}]}